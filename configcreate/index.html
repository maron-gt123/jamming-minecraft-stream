<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <title>config.yml Generator</title>
    <style>
        body {
          font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
          margin: 0;
          padding: 24px;
          background:
            radial-gradient(circle at top left, #25f4ee33, transparent 40%),
            radial-gradient(circle at bottom right, #fe2c5533, transparent 40%),
            #0b0b0f;
          color: #f5f5f7;
        }
        h1, h2 { color: #fff; margin-top: 0; }

        .panel {
          background: rgba(255,255,255,0.08);
          backdrop-filter: blur(10px);
          border-radius: 14px;
          padding: 16px;
          margin-bottom: 24px;
          box-shadow: 0 10px 28px rgba(0,0,0,0.45);
        }

        .event-row {
          display: flex;
          align-items: center;
          gap: 12px;
          margin-bottom: 10px;
        }

        .icon {
          font-size: 20px;
          width: 28px;
          text-align: center;
        }

        .gift-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
          gap: 16px;
        }

        .gift {
          background: rgba(255,255,255,0.12);
          border-radius: 12px;
          padding: 10px;
          display: flex;
          gap: 10px;
          align-items: flex-start;
          border: 2px solid transparent;
        }

        .gift.streakable { border-color: #25f4ee; }
        .gift.non-streakable { border-color: #fe2c55; opacity: 0.85; }

        .streak-label {
          font-size: 12px;
          font-weight: bold;
          margin-bottom: 4px;
        }
        .streakable .streak-label { color: #25f4ee; }
        .non-streakable .streak-label { color: #fe2c55; }

        .gift img {
          width: 40px;
          height: 40px;
          object-fit: contain;
        }

        input[type=text], input[type=number] {
          width: 150px;
          border-radius: 6px;
          border: none;
          padding: 4px 6px;
        }

        textarea {
          width: 100%;
          height: 340px;
          border-radius: 10px;
          border: none;
          padding: 12px;
          font-family: monospace;
        }

        button {
          padding: 12px 20px;
          border-radius: 999px;
          border: none;
          background: linear-gradient(135deg, #25f4ee, #fe2c55);
          color: #000;
          font-weight: bold;
          cursor: pointer;
          box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }
    </style>
</head>

<body>
<h1>ğŸµ TikTok Stream config.yml Generator</h1>

<div class="panel">
    <h2>ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š</h2>

    <div class="event-row">
        <span class="icon">ğŸ</span>
        <label><input type="checkbox" id="ev_gift" checked> Gift</label>
    </div>
    <div class="event-row">
        <span class="icon">â¤ï¸</span>
        <label><input type="checkbox" id="ev_like" checked> Like</label>
    </div>
    <div class="event-row">
        <span class="icon">â•</span>
        <label><input type="checkbox" id="ev_follow" checked> Follow</label>
        ã‚³ãƒãƒ³ãƒ‰ <input type="text" id="cmd_follow" value="say {nickname} follow">
    </div>
    <div class="event-row">
        <span class="icon">ğŸ”</span>
        <label><input type="checkbox" id="ev_share" checked> Share</label>
        ã‚³ãƒãƒ³ãƒ‰ <input type="text" id="cmd_share" value="say {nickname} share">
    </div>
    <div class="event-row">
        <span class="icon">â­</span>
        <label><input type="checkbox" id="ev_subscribe" checked> Subscribe</label>
        ã‚³ãƒãƒ³ãƒ‰ <input type="text" id="cmd_subscribe" value="say {nickname} subscribe">
    </div>
</div>

<div class="panel">
    <h2>ğŸ ã‚®ãƒ•ãƒˆè¨­å®šï¼ˆé€£ç¶šä¸å¯ï¼‰</h2>
    <div id="gifts-nonstreak" class="gift-grid"></div>
</div>

<div class="panel">
    <h2>ğŸ ã‚®ãƒ•ãƒˆè¨­å®šï¼ˆé€£ç¶šå¯ï¼‰</h2>
    <div id="gifts-streak" class="gift-grid"></div>
</div>

<div class="panel">
    <h2>â¤ï¸ Like è¨­å®šï¼ˆcountæ¡ä»¶ï¼‰</h2>
    <button onclick="addLikeRule()">ï¼‹ ãƒ«ãƒ¼ãƒ«è¿½åŠ </button>
    <div id="like-rules"></div>
</div>

<button onclick="generateYaml()">YAMLç”Ÿæˆ</button>

<div class="panel">
    <h2>ç”Ÿæˆçµæœ</h2>
    <textarea id="output" readonly></textarea>
</div>

<script>
    const CSV_URL =
      "https://raw.githubusercontent.com/maron-gt123/jamming-minecraft-stream/refs/heads/main/configcreate/gifts.csv";

    let gifts = [];

    fetch(CSV_URL)
      .then(r => r.text())
      .then(parseCSV);

    function parseCSV(text) {
      const lines = text.trim().split("\n");
      const header = lines.shift().split(",");
      gifts = lines.map(l => {
        const c = l.split(",");
        const o = {};
        header.forEach((h,i)=>o[h]=c[i]);
        return o;
      });
      renderGifts();
    }

    function renderGifts() {
      const non = document.getElementById("gifts-nonstreak");
      const yes = document.getElementById("gifts-streak");
      non.innerHTML = "";
      yes.innerHTML = "";

      gifts.forEach(g => {
        const isStreak = g.streakable === "True" || g.streakable === true;

        const d = document.createElement("div");
        d.className = "gift " + (isStreak ? "streakable" : "non-streakable");
        d.dataset.name = g.gift_name;

        d.innerHTML = `
          <input type="checkbox" class="gift-enable">
          <img src="${g.image_url}">
          <div>
            <div class="streak-label">${isStreak ? "é€£ç¶šå¯" : "é€£ç¶šä¸å¯"}</div>
            <strong>${g.gift_name}</strong><br>
            ğŸ’ ${g.diamond}<br>
            ${isStreak ? `é€£ç¶š <input type="number" class="gift-count" value="1" min="1"><br>` : ``}
            ã‚³ãƒãƒ³ãƒ‰<br>
            <input type="text" class="gift-command"
              value="say {nickname} sent ${g.gift_name}">
          </div>
        `;

        (isStreak ? yes : non).appendChild(d);
      });
    }

    function addLikeRule() {
      const div = document.createElement("div");
      div.className = "rule";
      div.innerHTML = `
        count <input type="number" class="like-count" min="1"><br><br>
        commands:<br>
        <div class="like-commands">
          <input type="text" class="like-command">
        </div>
        <button onclick="addLikeCommand(this)">ï¼‹ command</button>
        <button onclick="this.parentElement.remove()">å‰Šé™¤</button>
      `;
      document.getElementById("like-rules").appendChild(div);
    }

    function addLikeCommand(btn) {
      const wrap = btn.previousElementSibling;
      wrap.appendChild(document.createElement("br"));
      const input = document.createElement("input");
      input.type = "text";
      input.className = "like-command";
      wrap.appendChild(input);
    }

    function generateYaml() {
      const y = [];

      y.push("http:");
      y.push("  port: 8080");
      y.push("  path: /event\n");

      y.push("events:");
      ["gift","like","follow","share","subscribe"].forEach(e => {
        y.push(`  ${e}:`);
        y.push(`    enabled: ${document.getElementById("ev_"+e).checked}`);
      });

      y.push("\njammingbox:");
      y.push("  clear:");
      y.push("    countdown: 15");
      y.push("  replace:");
      y.push("    enabled: true");
      y.push("    bottom: IRON_BLOCK");
      y.push("    middle: GOLD_BLOCK");
      y.push("    top: DIAMOND_BLOCK\n");

      y.push("commands:");
      y.push("  like:");
      document.querySelectorAll("#like-rules .rule").forEach(rule => {
        const count = rule.querySelector(".like-count").value;
        const cmds = rule.querySelectorAll(".like-command");
        y.push(`    - count: ${count}`);
        if (cmds.length === 1) {
          y.push(`      command: "${cmds[0].value}"`);
        } else {
          y.push(`      commands:`);
          cmds.forEach(c => {
            y.push(`        - "${c.value}"`);
          });
        }
      });
      y.push(`  follow:\n    - command: "${cmd_follow.value}"`);
      y.push(`  share:\n    - command: "${cmd_share.value}"`);
      y.push(`  subscribe:\n    - command: "${cmd_subscribe.value}"`);

      y.push("  gift:");

      document.querySelectorAll(".gift").forEach(d => {
        if (!d.querySelector(".gift-enable").checked) return;

        y.push(`    - gift_name: "${d.dataset.name}"`);

        const count = d.querySelector(".gift-count");
        if (count) {
          y.push(`      count: ${count.value}`);
        }

        y.push(`      command: "${d.querySelector(".gift-command").value}"`);
      });

      output.value = y.join("\n");
    }
</script>
</body>
</html>
