<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <title>config.yml Generator</title>
    <style>
        body {
          font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
          margin: 0;
          padding: 24px;
          background:
            radial-gradient(circle at top left, #25f4ee33, transparent 40%),
            radial-gradient(circle at bottom right, #fe2c5533, transparent 40%),
            #0b0b0f;
          color: #f5f5f7;
        }
        h1, h2 { color: #fff; margin-top: 0; }

        .panel {
          position: relative;
          background: rgba(255,255,255,0.08);
          border-radius: 14px;
          padding: 16px;
          margin-bottom: 24px;
          box-shadow: 0 10px 28px rgba(0,0,0,0.45);
          overflow: hidden;
        }

        .panel::before {
          content: "";
          position: absolute;
          inset: 0;
          background: rgba(255,255,255,0.08);
          backdrop-filter: blur(10px);
          -webkit-backdrop-filter: blur(10px);
          z-index: -1;
          pointer-events: none;
        }

        .event-row {
          display: flex;
          align-items: center;
          gap: 12px;
          margin-bottom: 10px;
        }

        .icon {
          font-size: 20px;
          width: 28px;
          text-align: center;
        }

        .gift-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
          gap: 16px;
        }

        .gift {
          background: rgba(255,255,255,0.12);
          border-radius: 12px;
          padding: 10px;
          display: flex;
          gap: 10px;
          align-items: flex-start;
          border: 2px solid transparent;
        }

        .gift.streakable { border-color: #25f4ee; }
        .gift.non-streakable { border-color: #fe2c55; opacity: 0.85; }

        .streak-label {
          font-size: 12px;
          font-weight: bold;
          margin-bottom: 4px;
        }
        .streakable .streak-label { color: #25f4ee; }
        .non-streakable .streak-label { color: #fe2c55; }

        .gift img {
          width: 40px;
          height: 40px;
          object-fit: contain;
        }

        input[type=text], input[type=number] {
          width: 150px;
          border-radius: 6px;
          border: none;
          padding: 4px 6px;
        }

        textarea {
          width: 100%;
          height: 340px;
          border-radius: 10px;
          border: none;
          padding: 12px;
          font-family: monospace;
        }

        button {
          padding: 12px 20px;
          border-radius: 999px;
          border: none;
          background: linear-gradient(135deg, #25f4ee, #fe2c55);
          color: #000;
          font-weight: bold;
          cursor: pointer;
          box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }
    </style>
</head>

<body>
<h1>ğŸµ TikTok Stream config.yml Generator</h1>

<div class="panel">
    <h2>ğŸ§Š BOXå†…éƒ¨ã®è‡ªå‹•å¤‰æ› è¨­å®š</h2>
    <select id="mcVersion" onchange="changeVersion()">
        <option value="1.20" selected>1.20</option>
        <option value="1.19">1.19</option>
        <option value="1.18">1.18</option>
    </select>
    <div class="event-row">
        <img id="img_top" width="32" height="32">
        Top
        <input type="text" placeholder="æ¤œç´¢" oninput="searchBlock('top', this.value)">
        <select id="block_top" onchange="updateBlockImage('top')"></select>
    </div>
    <div class="event-row">
        <img id="img_middle" width="32" height="32">
        Middle
        <input type="text" placeholder="æ¤œç´¢" oninput="searchBlock('middle', this.value)">
        <select id="block_middle" onchange="updateBlockImage('middle')"></select>
    </div>
    <div class="event-row">
        <img id="img_bottom" width="32" height="32">
        Bottom
        <input type="text" placeholder="æ¤œç´¢" oninput="searchBlock('bottom', this.value)">
        <select id="block_bottom" onchange="updateBlockImage('bottom')"></select>
    </div>
    <h2>ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š</h2>
    <div class="event-row">
        <span class="icon">ğŸ</span>
        <label><input type="checkbox" id="ev_gift" checked> Gift</label>
    </div>
    <div class="event-row">
        <span class="icon">â¤ï¸</span>
        <label><input type="checkbox" id="ev_like" checked> Like</label>
    </div>
    <div class="event-row">
        <span class="icon">â•</span>
        <label><input type="checkbox" id="ev_follow" checked> Follow</label>
    </div>
    <div class="event-row">
        <div class="follow-commands">
            <select class="follow-command" onchange="updateOptionUI(this)"></select>
            <span class="follow-option-wrap"></span>
        </div>
        <button onclick="addEventCommand('follow', this)">ï¼‹ command</button>
    </div>
    <div class="event-row">
        <span class="icon">ğŸ”</span>
        <label><input type="checkbox" id="ev_share" checked> Share</label>
    </div>
    <div class="event-row">
        <div class="share-commands">
            <select class="share-command" onchange="updateOptionUI(this)"></select>
            <span class="share-option-wrap"></span>
        </div>
        <button onclick="addEventCommand('share', this)">ï¼‹ command</button>
    </div>
    <div class="event-row">
        <span class="icon">â­</span>
        <label><input type="checkbox" id="ev_subscribe" checked> Subscribe</label>
    </div>
    <div class="event-row">
        <div class="subscribe-commands">
            <select class="subscribe-command" onchange="updateOptionUI(this)"></select>
            <span class="subscribe-option-wrap"></span>
        </div>
        <button onclick="addEventCommand('subscribe', this)">ï¼‹ command</button>
    </div>
</div>

<div class="panel">
    <h2>ğŸ ã‚®ãƒ•ãƒˆè¨­å®šï¼ˆé€£ç¶šä¸å¯ï¼‰</h2>
    <div id="gifts-nonstreak" class="gift-grid"></div>
</div>

<div class="panel">
    <h2>ğŸ ã‚®ãƒ•ãƒˆè¨­å®šï¼ˆé€£ç¶šå¯ï¼‰</h2>
    <div id="gifts-streak" class="gift-grid"></div>
</div>

<div class="panel">
    <h2>â¤ï¸ Like è¨­å®šï¼ˆcountæ¡ä»¶ï¼‰</h2>
    <button onclick="addLikeRule()">ï¼‹ ãƒ«ãƒ¼ãƒ«è¿½åŠ </button>
    <div id="like-rules"></div>
</div>

<button onclick="generateYaml()">YAMLç”Ÿæˆ</button>

<div class="panel">
    <h2>ç”Ÿæˆçµæœ</h2>
    <textarea id="output" readonly></textarea>
</div>

<script>
    let MC_VERSION = "1.20";
    let CSV_URL =
      "https://raw.githubusercontent.com/maron-gt123/jamming-minecraft-stream/refs/heads/main/configcreate/gifts.csv";
    let gifts = [];
    let BLOCKS_URL =
      "https://raw.githubusercontent.com/PrismarineJS/minecraft-data/master/data/pc/1.20/blocks.json";
    let BLOCK_TEXTURE_BASE =
      `https://raw.githubusercontent.com/InventivetalentDev/minecraft-assets/${MC_VERSION}/assets/minecraft/textures/block/`;
    let LANG_URL =
      `https://raw.githubusercontent.com/InventivetalentDev/minecraft-assets/${MC_VERSION}/assets/minecraft/lang/ja_jp.json`;
    let BLOCKS = [];
    let JA_LANG = {};
    let commandMap = {};

    function changeVersion() {
      MC_VERSION = document.getElementById("mcVersion").value;
      loadBlocks();
    }

    function loadBlocks() {
      BLOCKS_URL =
        `https://raw.githubusercontent.com/PrismarineJS/minecraft-data/master/data/pc/${MC_VERSION}/blocks.json`;
      BLOCK_TEXTURE_BASE =
        `https://raw.githubusercontent.com/InventivetalentDev/minecraft-assets/${MC_VERSION}/assets/minecraft/textures/block/`;
      LANG_URL =
        `https://raw.githubusercontent.com/InventivetalentDev/minecraft-assets/${MC_VERSION}/assets/minecraft/lang/ja_jp.json`;

      Promise.all([
        fetch(LANG_URL).then(r => r.json()),
        fetch(BLOCKS_URL).then(r => r.json())
      ]).then(([lang, blocks]) => {
        JA_LANG = lang;
        BLOCKS = blocks
          .filter(b => b.name.includes("_block"))
          .map(b => {
            const key = "block.minecraft." + b.name.toLowerCase();
            return {
              id: b.name.toUpperCase(),
              name: b.name,
              label: JA_LANG[key] || b.name.replace(/_/g, " ").toUpperCase(),
              image: BLOCK_TEXTURE_BASE + b.name.toLowerCase() + ".png"
            };
          });
        renderAllBlocks();
      });
    }

    fetch(CSV_URL)
      .then(r => r.text())
      .then(parseCSV);

    function parseCSV(text) {
      const lines = text.trim().split("\n");
      const header = lines.shift().split(",");
      gifts = lines.map(l => {
        const c = l.split(",");
        const o = {};
        header.forEach((h,i)=>o[h]=c[i]);
        return o;
      });
      renderGifts();
    }

    function renderAllBlocks() {
      ["bottom", "middle", "top"].forEach(pos => {
        renderBlockSelect(pos, BLOCKS);
      });

      block_bottom.value = "IRON_BLOCK";
      block_middle.value = "GOLD_BLOCK";
      block_top.value = "DIAMOND_BLOCK";

      updateBlockImage("bottom");
      updateBlockImage("middle");
      updateBlockImage("top");
    }


    function renderBlockSelect(pos, list) {
      const sel = document.getElementById("block_" + pos);
      const current = sel.value;

      sel.innerHTML = "";
      list.forEach(b => {
        const opt = document.createElement("option");
        opt.value = b.id;
        opt.textContent = b.label;
        opt.dataset.img = b.image;
        sel.appendChild(opt);
      });

      // å¯èƒ½ãªã‚‰é¸æŠã‚’ç¶­æŒ
      if ([...sel.options].some(o => o.value === current)) {
        sel.value = current;
      }

      updateBlockImage(pos);
    }
    function searchBlock(pos, keyword) {
      const list = filterBlocks(keyword);
      renderBlockSelect(pos, list);
    }

    function updateBlockImage(pos) {
      const sel = document.getElementById("block_" + pos);
      const img = document.getElementById("img_" + pos);
      if (!sel || !img) return;
      const opt = sel.selectedOptions[0];
      if (!opt) return;
      img.src = opt.dataset.img;
    }
    function filterBlocks(keyword) {
      if (!keyword) return BLOCKS;
      const k = keyword.toLowerCase();
      return BLOCKS.filter(b =>
        b.label.toLowerCase().includes(k) ||
        b.name.toLowerCase().includes(k) ||
        b.id.toLowerCase().includes(k)
      );
    }

    function renderGifts() {
      const non = document.getElementById("gifts-nonstreak");
      const yes = document.getElementById("gifts-streak");
      non.innerHTML = "";
      yes.innerHTML = "";

      gifts.forEach(g => {
        const isStreak = g.streakable === "True" || g.streakable === true;

        const d = document.createElement("div");
        d.className = "gift " + (isStreak ? "streakable" : "non-streakable");
        d.dataset.name = g.gift_name;

        d.innerHTML = `
          <input type="checkbox" class="gift-enable">
          <img src="${g.image_url}">
          <div>
            <div class="streak-label">${isStreak ? "é€£ç¶šå¯" : "é€£ç¶šä¸å¯"}</div>
            <strong>${g.gift_name}</strong><br>
            ğŸ’ ${g.diamond}<br>
            ${isStreak ? `é€£ç¶š <input type="number" class="gift-count" value="1" min="1"><br>` : ``}
            ã‚³ãƒãƒ³ãƒ‰<br>
            <div class="gift-commands">
              <select class="gift-command" onchange="updateOptionUI(this)"></select>
              <span class="gift-option-wrap"></span>
            </div>
            <button onclick="addGiftCommand(this)">ï¼‹ command</button>
          </div>
        `;

        (isStreak ? yes : non).appendChild(d);
      });
    }

    function updateOptionUI(commandSelect) {
      const wrap =
        commandSelect.parentElement.querySelector(".gift-option-wrap")
        || commandSelect.parentElement.querySelector(".like-option-wrap")
        || commandSelect.parentElement.querySelector(".follow-option-wrap")
        || commandSelect.parentElement.querySelector(".share-option-wrap")
        || commandSelect.parentElement.querySelector(".subscribe-option-wrap");
      if (!wrap) return;
      wrap.innerHTML = "";

      const cmd = commandSelect.value;
      if (!cmd || !commandMap[cmd]) return;

      const info = commandMap[cmd];

      if (info.type === "msg") {
        const input = document.createElement("input");
        input.type = "text";
        input.className = "option-msg";
        input.placeholder = "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸";
        wrap.appendChild(input);
      }
      else if (info.type === "index") {
        const input = document.createElement("input");
        input.type = "number";
        input.className = "option-index";
        input.min = 1;
        wrap.appendChild(input);
      }

      else if (info.type === "select") {
        const sel = document.createElement("select");
        sel.className = "option-select";
        info.values.forEach(v => {
          const o = document.createElement("option");
          o.value = v;
          o.textContent = v;
          sel.appendChild(o);
        });
        wrap.appendChild(sel);
      }
    }

    function addGiftCommand(btn) {
      const commandsWrap = btn.previousElementSibling;

      const row = document.createElement("div");

      const sel = document.createElement("select");
      sel.className = "gift-command";
      sel.innerHTML = "<option value=''>ã‚³ãƒãƒ³ãƒ‰é¸æŠ</option>";
      Object.keys(commandMap).forEach(cmd => {
        const opt = document.createElement("option");
        opt.value = cmd;
        opt.textContent = cmd;
        sel.appendChild(opt);
      });

      const optionWrap = document.createElement("span");
      optionWrap.className = "gift-option-wrap";

      sel.onchange = () => updateOptionUI(sel);

      row.appendChild(sel);
      row.appendChild(optionWrap);
      commandsWrap.appendChild(row);
    }

    function addLikeRule() {
      const div = document.createElement("div");
      div.className = "rule";
      div.innerHTML = `
        count <input type="number" class="like-count" min="1"><br><br>
        commands:<br>
        <div class="like-commands">
          <select class="like-command" onchange="updateOptionUI(this)"></select>
          <span class="like-option-wrap"></span>
        </div>
        <button onclick="addLikeCommand(this)">ï¼‹ command</button>
        <button onclick="this.parentElement.remove()">å‰Šé™¤</button>
      `;
      document.getElementById("like-rules").appendChild(div);
      const sel = div.querySelector(".like-command");
      Object.keys(commandMap).forEach(cmd => {
        const opt = document.createElement("option");
        opt.value = cmd;
        opt.textContent = cmd;
        sel.appendChild(opt);
      });
      sel.value = "";
      populateCommandSelects();
    }

    function addEventCommand(type, btn) {
      const commandsWrap = btn.previousElementSibling;

      const row = document.createElement("div");

      const sel = document.createElement("select");
      sel.className = `${type}-command`;
      sel.innerHTML = "<option value=''>ã‚³ãƒãƒ³ãƒ‰é¸æŠ</option>";
      Object.keys(commandMap).forEach(cmd => {
        const opt = document.createElement("option");
        opt.value = cmd;
        opt.textContent = cmd;
        sel.appendChild(opt);
      });

      const optionWrap = document.createElement("span");
      optionWrap.className = `${type}-option-wrap`;

      sel.onchange = () => updateOptionUI(sel);

      row.appendChild(sel);
      row.appendChild(optionWrap);
      commandsWrap.appendChild(row);
    }

    function addLikeCommand(btn) {
      const commandsWrap = btn.previousElementSibling;

      const row = document.createElement("div");

      const sel = document.createElement("select");
      sel.className = "like-command";
      sel.innerHTML = "<option value=''>ã‚³ãƒãƒ³ãƒ‰é¸æŠ</option>";
      Object.keys(commandMap).forEach(cmd => {
        const opt = document.createElement("option");
        opt.value = cmd;
        opt.textContent = cmd;
        sel.appendChild(opt);
      });

      const optionWrap = document.createElement("span");
      optionWrap.className = "like-option-wrap";

      sel.onchange = () => updateOptionUI(sel);

      row.appendChild(sel);
      row.appendChild(optionWrap);
      commandsWrap.appendChild(row);
    }

    function buildCommand(select) {
      if (!select.value) return null;
      const wrap =
        select.parentElement.querySelector(".gift-option-wrap")
        || select.parentElement.querySelector(".like-option-wrap")
        || select.parentElement.querySelector(".follow-option-wrap")
        || select.parentElement.querySelector(".share-option-wrap")
        || select.parentElement.querySelector(".subscribe-option-wrap");
      if (!wrap) return select.value;
      const msg = wrap.querySelector(".option-msg");
      if (msg) return `${select.value} ${msg.value}`;
      const index = wrap.querySelector(".option-index");
      if (index) return `${select.value} ${index.value}`;
      const sel = wrap.querySelector(".option-select");
      if (sel) return `${select.value} ${sel.value}`;
      return select.value;
    }

    function generateYaml() {
      const y = [];

      y.push("http:");
      y.push("  port: 8080");
      y.push("  path: /event\n");

      y.push("events:");
      ["gift","like","follow","share","subscribe"].forEach(e => {
        y.push(`  ${e}:`);
        y.push(`    enabled: ${document.getElementById("ev_"+e).checked}`);
      });

      y.push("\njammingbox:");
      y.push("  clear:");
      y.push("    countdown: 15");
      y.push("  replace:");
      y.push("    enabled: true");
      y.push(`    bottom: ${block_bottom.value}`);
      y.push(`    middle: ${block_middle.value}`);
      y.push(`    top: ${block_top.value}\n`);

      // like
      y.push("  like:");
      document.querySelectorAll("#like-rules .rule").forEach(rule => {
        const count = rule.querySelector(".like-count").value;
        const cmds = Array.from(rule.querySelectorAll(".like-command"))
          .map(buildCommand)
          .filter(v => v);

        y.push(`    - count: ${count}`);
        if (cmds.length === 1) {
          y.push(`      command: "${cmds[0]}"`);
        } else if (cmds.length > 1) {
          y.push(`      commands:`);
          cmds.forEach(c => {
            y.push(`        - "${c}"`);
          });
        }
      });

      // follow / share / subscribe
      ["follow", "share", "subscribe"].forEach(e => {
        y.push(`  ${e}:`);

        const cmds = Array.from(
          document.querySelectorAll(`.${e}-command`)
        ).map(buildCommand).filter(v => v);

        if (cmds.length === 1) {
          y.push(`    - command: "${cmds[0]}"`);
        } else if (cmds.length > 1) {
          y.push(`    - commands:`);
          cmds.forEach(c => {
            y.push(`        - "${c}"`);
          });
        }
      });

      // gift
      y.push("  gift:");
      document.querySelectorAll(".gift").forEach(d => {
        if (!d.querySelector(".gift-enable").checked) return;

        y.push(`    - gift_name: "${d.dataset.name}"`);

        const count = d.querySelector(".gift-count");
        if (count) {
          y.push(`      count: ${count.value}`);
        }

        const cmds = Array.from(d.querySelectorAll(".gift-command"))
          .map(buildCommand)
          .filter(v => v);

        if (cmds.length === 1) {
          y.push(`      command: "${cmds[0]}"`);
        } else if (cmds.length > 1) {
          y.push(`      commands:`);
          cmds.forEach(c => {
            y.push(`        - "${c}"`);
          });
        }
      });

      output.value = y.join("\n");
    }
    const COMMAND_CSV_URL = "https://raw.githubusercontent.com/maron-gt123/jamming-minecraft-stream/refs/heads/main/configcreate/command.csv";

    function populateCommandSelects() {
      document.querySelectorAll(
        ".gift-command, .like-command, .follow-command, .share-command, .subscribe-command"
      ).forEach(sel => {
        const current = sel.value;
        sel.innerHTML = "<option value=''>ã‚³ãƒãƒ³ãƒ‰é¸æŠ</option>";
        Object.keys(commandMap).forEach(cmd => {
          const opt = document.createElement("option");
          opt.value = cmd;
          opt.textContent = cmd;
          sel.appendChild(opt);
        });
        sel.value = current;
        sel.onchange = () => updateOptionUI(sel);
      });
    }

    function loadCommands() {
      fetch(COMMAND_CSV_URL)
        .then(r => r.text())
        .then(text => {
          commandMap = {};
          const lines = text.trim().split("\n").slice(1);

          lines.forEach(l => {
            const [cmd, opt] = l.split(",");
            const c = cmd.trim();
            const o = opt.trim();

            if (o.toLowerCase() === "msg") {
              commandMap[c] = { type: "msg" };
            }
            else if (o.toLowerCase() === "index") {
              commandMap[c] = { type: "index" };
            }
            else {
              if (!commandMap[c]) {
                commandMap[c] = { type: "select", values: [] };
              }
              commandMap[c].values.push(o);
            }
          });

          populateCommandSelects();

          ["follow", "share", "subscribe"].forEach(e => {
            const sel = document.getElementById("cmd_" + e);
            sel.innerHTML = "<option value=''>ã‚³ãƒãƒ³ãƒ‰é¸æŠ</option>";
            Object.keys(commandMap).forEach(cmd => {
              const opt = document.createElement("option");
              opt.value = cmd;
              opt.textContent = cmd;
              sel.appendChild(opt);
            });
          });
        });
    }

    loadBlocks();
    loadCommands();
    populateCommandSelects();
</script>
</body>
</html>